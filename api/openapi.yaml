openapi: 3.0.0
info:
  version: 0.0.1
  title: Keycard API
  description: Keycard API for managing zones and their resources.
servers:
  - url: /
paths:
  /zones:
    get:
      operationId: listZones
      summary: List zones
      description: Returns a list of zones for the authenticated organization
      parameters:
        - name: slug
          in: query
          required: false
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            maximum: 1000
            minimum: 1
      responses:
        '200':
          description: Default Response
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Zone'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'
                required:
                  - items
                  - page_info
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - bearerAuth: []
      tags:
        - Zones
    post:
      operationId: createZone
      summary: Create zone
      description: Creates a new zone for the authenticated organization. A zone is an isolated environment for IAM resources.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ZoneCreate'
      responses:
        '200':
          description: A zone for organizing resources within an organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Zone'
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - bearerAuth: []
      tags:
        - Zones
  '/zones/{id}':
    get:
      operationId: getZone
      summary: Get zone
      description: Returns details of a specific zone by ID
      parameters:
        - name: id
          in: path
          description: Zone ID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: A zone for organizing resources within an organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Zone'
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - bearerAuth: []
      tags:
        - Zones
    patch:
      operationId: updateZone
      summary: Update zone
      description: Updates a zone's configuration (partial update)
      parameters:
        - name: id
          in: path
          description: Zone ID
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ZoneUpdate'
      responses:
        '200':
          description: A zone for organizing resources within an organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Zone'
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - bearerAuth: []
      tags:
        - Zones
    delete:
      operationId: deleteZone
      summary: Delete zone
      description: Permanently deletes a zone and all its associated resources
      parameters:
        - name: id
          in: path
          description: Zone ID
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Default Response
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - bearerAuth: []
      tags:
        - Zones
components:
  schemas:
    PageInfo:
      description: Pagination information
      type: object
      properties:
        has_next_page:
          description: Whether there are more items after the current page
          type: boolean
        has_previous_page:
          description: Whether there are items before the current page
          type: boolean
        start_cursor:
          description: Cursor pointing to the first item in the current page
          type: string
          nullable: true
        end_cursor:
          description: Cursor pointing to the last item in the current page
          type: string
          nullable: true
      additionalProperties: false
      required:
        - has_next_page
        - has_previous_page
      title: Page Info
    Error:
      description: Error response
      type: object
      properties:
        message:
          type: string
        code:
          type: string
        status:
          type: number
      required:
        - message
        - code
        - status
      title: Error
    Zone:
      description: A zone for organizing resources within an organization
      type: object
      properties:
        id:
          description: Unique identifier of the zone
          type: string
        organization_id:
          description: Organization that owns this zone
          type: string
        slug:
          description: 'URL-safe identifier, unique within the zone'
          type: string
          maxLength: 63
          minLength: 1
          pattern: '^[a-z0-9]+(?:-[a-z0-9]+)*$'
        name:
          description: Human-readable name
          type: string
          maxLength: 255
          minLength: 1
        description:
          description: Human-readable description
          type: string
          maxLength: 2048
          nullable: true
        cname:
          description: Custom domain name (CNAME) for the zone
          type: string
          format: hostname
          maxLength: 255
        user_identity_provider_id:
          description: Provider ID configured for user login
          type: string
        oauth2_pkce_required:
          description: Whether PKCE is required for authorization code flows
          type: boolean
        oauth2_dcr_enabled:
          description: Whether Dynamic Client Registration is enabled
          type: boolean
        protocols:
          type: object
          properties:
            oauth2:
              type: object
              properties:
                issuer:
                  description: OAuth 2.0 issuer identifier
                  type: string
                  format: uri
                authorization_server_metadata:
                  description: OAuth 2.0 Authorization Server Metadata endpoint (.well-known/oauth-authorization-server)
                  type: string
                  format: uri
                authorization_endpoint:
                  description: OAuth 2.0 authorization endpoint
                  type: string
                  format: uri
                token_endpoint:
                  description: OAuth 2.0 token endpoint
                  type: string
                  format: uri
                redirect_uri:
                  description: OAuth 2.0 redirect URI for this zone
                  type: string
                  format: uri
                registration_endpoint:
                  description: OAuth 2.0 Dynamic Client Registration endpoint
                  type: string
                  format: uri
                jwks_uri:
                  description: JSON Web Key Set endpoint
                  type: string
                  format: uri
              required:
                - issuer
                - authorization_server_metadata
                - authorization_endpoint
                - token_endpoint
                - redirect_uri
                - registration_endpoint
                - jwks_uri
            openid:
              type: object
              properties:
                provider_configuration:
                  description: OpenID Connect Provider Configuration endpoint (.well-known/openid-configuration)
                  type: string
                  format: uri
                userinfo_endpoint:
                  description: OpenID Connect UserInfo endpoint
                  type: string
                  format: uri
              required:
                - provider_configuration
                - userinfo_endpoint
          required:
            - oauth2
            - openid
        created_at:
          description: Entity creation timestamp
          type: string
          format: date-time
        updated_at:
          description: Entity update timestamp
          type: string
          format: date-time
      required:
        - id
        - organization_id
        - slug
        - name
        - oauth2_pkce_required
        - oauth2_dcr_enabled
        - protocols
        - created_at
        - updated_at
      title: Zone
    ZoneCreate:
      description: Schema for creating a new zone
      type: object
      properties:
        name:
          description: Human-readable name
          type: string
          maxLength: 255
          minLength: 1
        description:
          description: Human-readable description
          type: string
          maxLength: 2048
          nullable: true
        cname:
          description: Custom domain name (CNAME) for the zone
          type: string
          format: hostname
          maxLength: 255
        oauth2_pkce_required:
          description: Whether PKCE is required for authorization code flows
          type: boolean
          default: true
        oauth2_dcr_enabled:
          description: Whether Dynamic Client Registration is enabled
          type: boolean
          default: true
      required:
        - name
      title: Zone Create
    ZoneUpdate:
      description: Schema for updating an existing zone (partial update)
      type: object
      properties:
        name:
          description: Human-readable name
          type: string
          maxLength: 255
          minLength: 1
        description:
          description: Human-readable description
          type: string
          maxLength: 2048
          nullable: true
        cname:
          description: Custom domain name (CNAME) for the zone (set to null to remove)
          type: string
          format: hostname
          maxLength: 255
          nullable: true
        user_identity_provider_id:
          description: Provider ID to configure for user login (set to null to unset)
          type: string
          nullable: true
        oauth2_pkce_required:
          description: Whether PKCE is required for authorization code flows
          type: boolean
        oauth2_dcr_enabled:
          description: Whether Dynamic Client Registration is enabled
          type: boolean
      title: Zone Update
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Bearer Token Authentication
